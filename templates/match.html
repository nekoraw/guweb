{% extends 'base.html' %} {% block title %} Match {{ match_id }} {% endblock %}
{% block header %}
<!DOCTYPE html>
<script src="/static/js/asserts/vue.js"></script>
<script src="/static/js/asserts/vue-axios.js"></script>
<script src="/static/js/asserts/day-js/dayjs.min.js"></script>
<script src="/static/js/asserts/day-js/locale/pt-br.js"></script>
<script src="/static/js/asserts/day-js/plugin/relativeTime.js"></script>
<script src="/static/js/asserts/day-js/plugin/utc.js"></script>

<!-- <meta http-equiv="refresh" content="1"> -->
<script>
  let matchId = "{{ match_id }}";
  let domain = "{{ domain() }}";
  let appName = "{{ appName() }}";
  let beatmapDownloadMirror = "{{ beatmap_download_mirror() }}";

  dayjs.extend(window.dayjs_plugin_relativeTime);
  dayjs.extend(window.dayjs_plugin_utc);
  dayjs.locale("pt-br");
</script>

<link rel="stylesheet" href="/static/css/pages/leaderboard.css" />
<link rel="stylesheet" href="/static/css/pages/match.css" />

{% endblock %} {% block content %}

<div id="app" :class="">
  <div class="main-block">
    <template>
      <h1 id="match-title"><% matchEvents[0].name %></h1>
      <div id="match-events">
        <div class="match-event" v-for="(event, index) in matchEvents">
          <div><% event %></div>
          <div class="player-join-event" v-if="(event.type === 'player_join')">
            <span class="match-event-time"><% event.time %></span>
            <p>
              Jogador
              <a :href="`/u/${event.player_id}`"><% event.player_name %></a> se
              juntou ao lobby.
            </p>
          </div>
          <div
            class="match-created-event"
            v-else-if="(event.type === 'match_created')"
          >
            <span class="match-event-time"><% event.time %></span>
            <p>A partida foi criada.</p>
          </div>
          <!-- host-change-event -->
          <div
            class="match-created-event"
            v-else-if="(event.type === 'change_host')"
          >
            <span class="match-event-time"><% event.time %></span>
            <p>
              O host foi trocado de
              <a :href="`/u/${event.old_player}`"
                ><% event.old_player_name %></a
              >
              para
              <a :href="`/u/${event.new_player}`"
                ><% event.new_player_name %></a
              >
              .
            </p>
          </div>
          <!-- beatmap-play-event -->
          <div
            class="beatmap-play-event"
            v-else-if="(event.type === 'beatmap_play')"
          >
            <% event %>
            <div
              v-if="(matchBeatmaps?.has(event.bmap_id))"
              class="beatmap-banner"
            >
              <div class="beatmap-banner-overlay">
                <div class="banner-overlay-top">
                  <div>
                    <p class="overlay-beatmap-title">
                      <% matchBeatmaps.get(event.bmap_id).title %>
                    </p>
                    <p class="overlay-beatmap-version">
                      [<% matchBeatmaps.get(event.bmap_id).version %>]
                    </p>
                    <p class="overlay-beatmap-gamemode">
                      <% event.gamemode.toLowerCase().replace("_", " ") %>
                    </p>
                  </div>
                  <p class="overlay-beatmap-sr">
                    <% matchBeatmaps.get(event.bmap_id).diff.toFixed(2) %>
                  </p>
                </div>
                <div class="banner-overlay-bottom">
                  <a
                    class="banner-overlay-button"
                    :href="`/beatmaps/${event.bmap_id}`"
                  >
                    Abrir pagina do mapa
                  </a>
                  <p class="overlay-win-condition"><% event.win_condition %></p>
                </div>
              </div>
              <img
                :src="`https://assets.ppy.sh/beatmaps/${event.bmapset_id}/covers/cover@2x.jpg`"
                alt=""
              />
            </div>
            <div
              :class="`play-score ${index === 0 && 'first-place-score'}`"
              v-for="(score, index) in event.scores"
            >
              <span class="score-colocation">#<% index + 1 %></span>
              <img
                class="score-pfp"
                :src="`https://a.${domain}/${score.player_id}`"
                alt=""
              />
              <div
                style="
                  display: flex;
                  flex-direction: column;
                  justify-content: center;
                "
              >
                <h2>
                  <a :href="`/u/${score.player_id}`" class="score-player-name"
                    ><% score.player_name %></a
                  >
                </h2>
                <div style="display: flex; gap: 0.25rem">
                  <div
                    class="player-flag"
                    :style="`background-image:url('/static/images/flags/${score.player_country.toUpperCase()}.png'); margin-right:0`"
                  >
                    <div class="flag-dropdown">
                      <% flags[score.player_country.toUpperCase()] %>
                    </div>
                  </div>
                  <span>+<% score.used_mods.replace("V2", "") %></span>
                </div>
              </div>
              <div style="margin-left: auto; text-align: right">
                <p
                  :class="`score-score ${(event.win_condition === 'score' || event.win_condition === 'scorev2') && 'win-condition'}`"
                >
                  <% score.score.toLocaleString() %>
                </p>
                <div style="display: flex; gap: 0.5rem">
                  <p
                    :class="`score-max-combo ${event.win_condition === 'combo' && 'win-condition'}`"
                  >
                    <% score.max_combo.toLocaleString() %>x
                  </p>

                  <p
                    :class="`score-acc ${event.win_condition === 'accuracy' && 'win-condition'}`"
                  >
                    <% score.accuracy.toFixed(2) %>%
                  </p>
                </div>
              </div>

              <!-- <% score %> -->
            </div>
            <div
              v-if="(event.team_type === 'team_vs')"
              class="team-points-container"
            >
              <div class="team-points">
                <p class="points-text">Pontos da equipe Vermelha</p>
                <p class="red-points"><% event.redTeamPoints %></p>
              </div>
              <div class="team-points">
                <p class="points-text">Pontos da equipe Azul</p>
                <p class="blue-points"><% event.blueTeamPoints %></p>
              </div>
            </div>
          </div>
          <div
            class="player-leave-event"
            v-if="(event.type === 'player_leave')"
          >
            <span class="match-event-time"><% event.time %></span>
            <p>
              Jogador
              <a :href="`/u/${event.player_id}`"><% event.player_name %></a>
              deixou a partida.
            </p>
          </div>
          <div class="match-ended-event" v-if="(event.type === 'lobby_close')">
            <span class="match-event-time"><% event.time %></span>
            <p>A partida terminou.</p>
          </div>
        </div>
      </div>
    </template>
  </div>
</div>
<script src="/static/js/asserts/vue-flags.js"></script>
<script src="/static/js/pages/matches.js"></script>
{% endblock %}
